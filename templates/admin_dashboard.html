<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
    <div class="container">
        <a class="navbar-brand" href="/admin/dashboard">Admin Dashboard</a>
        <div class="collapse navbar-collapse">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item"><a class="nav-link" href="/admin/recharges">Recharges</a></li>
                <li class="nav-item"><a class="nav-link" href="/admin/withdrawals">Withdrawals</a></li>
                <li class="nav-item"><a class="nav-link" href="/logout">Logout</a></li>
            </ul>
        </div>
    </div>
</nav>

<div class="container">

    <!-- Flash messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ 'success' if category=='success' else 'danger' }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <!-- Users Table -->
    <h3 class="mb-3">Users</h3>
    <table class="table table-striped table-hover">
        <thead class="table-dark">
        <tr>
            <th>ID</th>
            <th>Username</th>
            <th>Balance</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        {% for u in users %}
            <tr>
                <td>{{ u.id }}</td>
                <td>{{ u.username }}</td>
                <td>${{ u.balance }}</td>
                <td>
                    <form action="/admin/user/reset_password/{{ u.id }}" method="POST" class="d-inline">
                        <input type="text" name="new_password" placeholder="New password" class="form-control form-control-sm" required>
                        <button class="btn btn-sm btn-primary mt-1" type="submit">Reset</button>
                    </form>
                    <a href="/admin/user/delete/{{ u.id }}" class="btn btn-sm btn-danger mt-1" onclick="return confirm('Delete user?')">Delete</a>
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

    <!-- Withdrawals Table -->
    <h3 class="mt-5 mb-3">Withdrawals</h3>
    <table class="table table-striped table-hover">
        <thead class="table-dark">
        <tr>
            <th>ID</th>
            <th>User</th>
            <th>Amount</th>
            <th>Status</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        {% for w in withdrawals %}
            <tr>
                <td>{{ w.id }}</td>
                <td>{{ w.user.username }}</td>
                <td>${{ w.amount }}</td>
                <td>{{ w.status }}</td>
                <td>
                    {% if w.status == "Pending" %}
                        <a href="/admin/approve/{{ w.id }}" class="btn btn-sm btn-success">Approve</a>
                        <a href="/admin/reject/{{ w.id }}" class="btn btn-sm btn-danger">Reject</a>
                    {% else %}
                        <span class="text-muted">No actions</span>
                    {% endif %}
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

    <!-- Recharges Table -->
    <h3 class="mt-5 mb-3">Recharges</h3>
    <table class="table table-striped table-hover">
        <thead class="table-dark">
        <tr>
            <th>ID</th>
            <th>User</th>
            <th>Amount</th>
            <th>Status</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        {% for r in recharges %}
            <tr>
                <td>{{ r.id }}</td>
                <td>{{ r.user.username }}</td>
                <td>${{ r.amount }}</td>
                <td>{{ r.status }}</td>
                <td>
                    {% if r.status == "Pending" %}
                        <a href="/admin/approve_recharge/{{ r.id }}" class="btn btn-sm btn-success">Approve</a>
                        <a href="/admin/reject_recharge/{{ r.id }}" class="btn btn-sm btn-danger">Reject</a>
                    {% else %}
                        <span class="text-muted">No actions</span>
                    {% endif %}
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
