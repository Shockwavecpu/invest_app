<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Products</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .btn-buy { margin-top: 5px; }
        .insufficient { color: red; font-weight: bold; }
    </style>
</head>
<body>
<div class="container mt-5">
    <h1>Products</h1>
    <p><a href="/dashboard">&larr; Back to Dashboard</a></p>

    <table class="table table-bordered">
        <thead class="table-light">
        <tr>
            <th>Package Name</th>
            <th>Price (ZMW)</th>
            <th>Daily Earnings</th>
            <th>Duration</th>
            <th>Total Return</th>
            <th>ROI</th>
            <th>Action</th>
        </tr>
        </thead>
        <tbody>
        {% for p in products %}
        {% set bg, color = '', '' %}
        {% if 'Starter' in p.name %}
            {% set bg = '#dc3545' %} {% set color = 'white' %}
        {% elif 'Standard' in p.name %}
            {% set bg = '#ffffff' %} {% set color = 'black' %}
        {% elif 'Premium' in p.name %}
            {% set bg = '#28a745' %} {% set color = 'white' %}
        {% endif %}
        <tr>
            <td style="background-color: {{ bg }}; color: {{ color }};">{{ p.name }}</td>
            <td style="background-color: {{ bg }}; color: {{ color }};">K{{ "%.2f"|format(p.price) }}</td>
            <td style="background-color: {{ bg }}; color: {{ color }};">K{{ "%.2f"|format(p.daily_earning) }}/day</td>
            <td style="background-color: {{ bg }}; color: {{ color }};">{{ p.duration_days }} days</td>
            <td style="background-color: {{ bg }}; color: {{ color }};">K{{ "%.2f"|format(p.daily_earning * p.duration_days) }}</td>
            <td style="background-color: {{ bg }}; color: {{ color }};">
                {% set roi = ((p.daily_earning * p.duration_days - p.price) / p.price * 100) %}
                +{{ "%.0f"|format(roi) }}%
            </td>
            <td style="background-color: {{ bg }}; color: {{ color }};">
                {% if user.balance >= p.price %}
                    <a href="/buy_product/{{ p.id }}" class="btn btn-success btn-sm btn-buy">Buy Now</a>
                {% else %}
                    <span class="insufficient">Insufficient balance</span>
                {% endif %}
            </td>
        </tr>
        {% else %}
        <tr><td colspan="7">No products.</td></tr>
        {% endfor %}
        </tbody>
    </table>
</div>
</body>
</html>
