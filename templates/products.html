<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Products</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        .btn-buy { margin-top: 5px; }
        .insufficient { color: red; font-weight: bold; }
        .header-title {
            font-weight: 700;
            margin-bottom: 20px;
        }
        table th, table td {
            vertical-align: middle !important;
            text-align: center;
        }
    </style>
</head>

<body>

<div class="container mt-4 mb-5">

    <!-- Header -->
    <h2 class="header-title text-center">Available Investment Packages</h2>
    <p class="text-center mb-4">
        <a href="/dashboard" class="btn btn-secondary btn-sm">&larr; Back to Dashboard</a>
    </p>

    <!-- Products Table -->
    <div class="table-responsive">
        <table class="table table-bordered table-striped shadow-sm">
            <thead class="table-dark">
                <tr>
                    <th>Package</th>
                    <th>Price (ZMW)</th>
                    <th>Daily Earnings</th>
                    <th>Duration</th>
                    <th>Total Return</th>
                    <th>ROI</th>
                    <th>Action</th>
                </tr>
            </thead>

            <tbody>
                {% if products %}
                {% for p in products %}
                {% set bg, color = '', '' %}

                {% if 'Starter' in p.name %}
                    {% set bg = '#dc3545' %}  {# RED #}
                    {% set color = 'white' %}
                {% elif 'Standard' in p.name %}
                    {% set bg = '#ffffff' %} {# WHITE #}
                    {% set color = 'black' %}
                {% elif 'Premium' in p.name %}
                    {% set bg = '#28a745' %}  {# GREEN #}
                    {% set color = 'white' %}
                {% endif %}

                <tr style="background-color: {{ bg }}; color: {{ color }};">
                    <td>{{ p.name }}</td>
                    <td>K{{ "%.2f"|format(p.price) }}</td>
                    <td>K{{ "%.2f"|format(p.price * 0.20) }}/day</td>
                    <td>{{ p.duration_days }} days</td>
                    <td>K{{ "%.2f"|format(p.price * 0.20 * p.duration_days) }}</td>

                    <td>
                        {% set roi = ((p.price * 0.20 * p.duration_days - p.price) / p.price * 100) %}
                        +{{ "%.0f"|format(roi) }}%
                    </td>

                    <td>
                        {% if user.balance >= p.price %}
                            <a href="/buy_product/{{ p.id }}" class="btn btn-success btn-sm btn-buy">Buy Now</a>
                        {% else %}
                            <span class="insufficient">Insufficient balance</span>
                        {% endif %}
                    </td>
                </tr>

                {% endfor %}
                {% else %}
                <tr>
                    <td colspan="7" class="text-center fw-bold">No products available</td>
                </tr>
                {% endif %}
            </tbody>

        </table>
    </div>

</div>

</body>
</html>
